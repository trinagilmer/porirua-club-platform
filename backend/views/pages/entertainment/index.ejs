<% const entertainmentList = entertainmentEvents || []; const regularList = regularEvents || []; const pastList = pastEvents || []; const isEmbed = Boolean(embed); const detailSuffix = isEmbed ? '?embed=1' : ''; %>

<% if (showEntertainmentHeader && !isEmbed) { %>
  <div class="entertainment-hero d-flex flex-column align-items-center text-center py-5 position-relative overflow-hidden" style="background: linear-gradient(120deg, #0f172a, #1d4ed8);">
    <div class="hero-content text-white position-relative">
      <%- entertainmentHeaderHtml || '<p class="text-uppercase fw-semibold tracking-wide mb-1">Porirua Club</p><h1 class="display-4 fw-bold mb-3">Live entertainment &amp; events</h1><p class="lead mb-0">Discover upcoming music, comedy, and special nights at the Club.</p>' %>
    </div>
  </div>
<% } %>

<div class="container <%= isEmbed ? 'py-3' : 'py-5' %> entertainment-page">
  <div class="d-flex flex-wrap justify-content-between align-items-center mb-4 gap-3">
    <div>
      <% if (!isEmbed) { %>
        <p class="text-uppercase small text-muted mb-1">Browse schedule</p>
        <h2 class="h4 mb-0">What's on at the Club</h2>
      <% } else { %>
        <h2 class="h5 mb-0">Entertainment calendar</h2>
      <% } %>
    </div>
    <div class="ent-calendar-controls">
      <div class="btn-group ent-toggle" role="group" aria-label="Event filter">
        <input
          type="radio"
          class="btn-check"
          name="ent-mode"
          id="entToggleEntertainment"
          value="entertainment"
          autocomplete="off"
          <%= initialCalendarType === 'entertainment' ? 'checked' : '' %>
        >
        <label class="btn btn-outline-primary px-4" for="entToggleEntertainment">
          Entertainment
        </label>
        <input
          type="radio"
          class="btn-check"
          name="ent-mode"
          id="entToggleRegular"
          value="regularevents"
          autocomplete="off"
          <%= initialCalendarType === 'regularevents' ? 'checked' : '' %>
        >
        <label class="btn btn-outline-primary px-4" for="entToggleRegular">
          Regular events
        </label>
      </div>
      <div class="btn-group ent-view-toggle" role="group" aria-label="Calendar view">
        <button type="button" class="btn btn-outline-secondary px-3" data-ent-view="month">Month</button>
        <button type="button" class="btn btn-outline-secondary px-3" data-ent-view="week">Week</button>
        <button type="button" class="btn btn-outline-secondary px-3" data-ent-view="agenda">Agenda</button>
        <button type="button" class="btn btn-outline-secondary px-3" data-ent-view="pinboard">Pinboard</button>
      </div>
    </div>
  </div>

  <section class="ent-calendar-shell card shadow-sm border-0">
    <div class="ent-calendar-header">
      <div>
        <p class="ent-calendar-subtitle mb-1">Entertainment calendar</p>
        <h3 class="ent-calendar-title mb-0" id="entCalendarTitle"></h3>
      </div>
      <div class="ent-calendar-nav">
        <button type="button" class="btn btn-light" data-cal-nav="prev" aria-label="Previous">
          <i class="bi bi-chevron-left"></i>
        </button>
        <button type="button" class="btn btn-light" data-cal-nav="today">Today</button>
        <button type="button" class="btn btn-light" data-cal-nav="next" aria-label="Next">
          <i class="bi bi-chevron-right"></i>
        </button>
      </div>
    </div>
    <div
      id="entertainmentCalendar"
      class="ent-calendar"
      data-initial-view="<%= initialCalendarView %>"
      data-initial-type="<%= initialCalendarType %>"
      data-embed="<%= isEmbed ? '1' : '0' %>"
    ></div>
  </section>

  <section class="ent-pinboard-shell d-none">
    <div class="ent-pinboard" data-mode="entertainment">
      <% if (!entertainmentList.length) { %>
        <div class="alert alert-light border text-center py-5">
          <h4 class="mb-2">New entertainment schedule coming soon</h4>
          <p class="text-muted mb-0">Check back shortly for upcoming performances and events.</p>
        </div>
      <% } else { %>
        <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
          <% entertainmentList.forEach(function(event) { %>
            <div class="col">
              <article class="card ent-card h-100 shadow-sm">
                <% if (event.image_url) { %>
                  <img src="<%= event.image_url %>" class="entertainment-card-img" alt="<%= event.title %>" loading="lazy">
                <% } else { %>
                  <div class="entertainment-card-img bg-light d-flex align-items-center justify-content-center text-muted">
                    <span class="small text-uppercase tracking-wide">Porirua Club</span>
                  </div>
                <% } %>
                <div class="card-body">
                  <span class="ent-date text-muted text-uppercase small mb-2"><%= new Date(event.start_at).toLocaleDateString('en-NZ', { weekday: 'long', month: 'long', day: 'numeric', timeZone: 'Pacific/Auckland' }) %></span>
                  <h3 class="h5 mb-2"><a href="/entertainment/<%= event.slug || event.id %><%= detailSuffix %>" class="stretched-link text-decoration-none text-dark"><%= event.title %></a></h3>
                <% const extraRooms = Array.isArray(event.additional_room_names) ? event.additional_room_names : []; %>
                <% const roomNames = [event.room_name].concat(extraRooms).filter(Boolean); %>
                <% if (roomNames.length) { %>
                  <p class="text-muted small mb-1"><i class="bi bi-geo-alt me-1"></i><%= roomNames.join(", ") %></p>
                <% } %>
                <% if (event.acts && event.acts.length) { %>
                  <p class="text-muted small mb-2">Acts: <%= event.acts.map(function(act) { return act.name; }).join(", ") %></p>
                <% } %>
                  <% if (event.description) { %>
                    <p class="text-muted mb-0"><%= event.description.replace(/<[^>]+>/g, '').slice(0, 130) %>...</p>
                  <% } %>
                </div>
                <div class="card-footer bg-transparent d-flex justify-content-between align-items-center text-muted">
                  <span class="small"><i class="bi bi-clock me-1"></i><%= event.start_at ? new Date(event.start_at).toLocaleTimeString('en-NZ', { hour: '2-digit', minute: '2-digit', timeZone: 'Pacific/Auckland' }) : '' %></span>
                  <% if (event.external_url) { %>
                    <a href="<%= event.external_url %>" target="_blank" rel="noopener" class="small text-decoration-none text-dark">More info</a>
                  <% } %>
                </div>
              </article>
            </div>
          <% }) %>
        </div>
      <% } %>
    </div>

    <div class="ent-pinboard d-none" data-mode="regularevents">
      <% if (!regularList.length) { %>
        <div class="alert alert-light border text-center py-5">
          <h4 class="mb-2">No regular club events listed yet</h4>
          <p class="text-muted mb-0">Check back as adjunct nights and club happenings are published.</p>
        </div>
      <% } else { %>
        <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
          <% regularList.forEach(function(event) { %>
            <div class="col">
              <article class="card h-100 shadow-sm border-0 rounded-4 bg-white regular-card">
                <% if (event.image_url) { %>
                  <img src="<%= event.image_url %>" class="entertainment-card-img" alt="<%= event.title %>" loading="lazy">
                <% } %>
                <div class="card-body">
                  <span class="ent-date text-primary text-uppercase small mb-2"><%= new Date(event.start_at).toLocaleDateString('en-NZ', { weekday: 'long', month: 'long', day: 'numeric', timeZone: 'Pacific/Auckland' }) %></span>
                  <h3 class="h5 mb-2"><a href="/entertainment/<%= event.slug || event.id %><%= detailSuffix %>" class="stretched-link text-decoration-none"><%= event.title %></a></h3>
                  <% const extraRooms = Array.isArray(event.additional_room_names) ? event.additional_room_names : []; %>
                  <% const roomNames = [event.room_name].concat(extraRooms).filter(Boolean); %>
                  <% if (roomNames.length) { %>
                    <p class="text-muted small mb-1"><i class="bi bi-geo-alt me-1"></i><%= roomNames.join(", ") %></p>
                  <% } %>
                  <% if (event.adjunct_name) { %>
                    <p class="text-muted small mb-1">Adjunct: <%= event.adjunct_name %></p>
                  <% } %>
                  <% if (event.description) { %>
                    <p class="text-muted mb-0"><%= event.description.replace(/<[^>]+>/g, '').slice(0, 120) %>...</p>
                  <% } %>
                </div>
                <div class="card-footer bg-transparent d-flex justify-content-between align-items-center">
                  <span class="small text-muted"><i class="bi bi-clock me-1"></i><%= event.start_at ? new Date(event.start_at).toLocaleTimeString('en-NZ', { hour: '2-digit', minute: '2-digit', timeZone: 'Pacific/Auckland' }) : '' %></span>
                  <% if (event.external_url) { %>
                    <a href="<%= event.external_url %>" target="_blank" rel="noopener" class="small text-decoration-none">More info</a>
                  <% } %>
                </div>
              </article>
            </div>
          <% }) %>
        </div>
      <% } %>
    </div>
  </section>
</div>

<% if (!isEmbed && pastList.length) { %>
  <div class="container">
    <div class="mt-5 pt-4 border-top">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <div>
          <p class="text-uppercase small text-muted mb-1">Previously</p>
          <h2 class="h5 mb-0">Recent events at the Club</h2>
        </div>
        <a href="/entertainment" class="btn btn-outline-secondary btn-sm">Back to top</a>
      </div>
      <div class="row row-cols-1 row-cols-md-3 g-3">
        <% pastList.forEach(function(event) { %>
          <div class="col">
            <article class="card border-0 shadow-sm h-100 rounded-4">
              <% if (event.image_url) { %>
                <img src="<%= event.image_url %>" alt="<%= event.title %>" class="entertainment-card-img rounded-top-4">
              <% } %>
              <div class="card-body">
                <span class="ent-date text-primary text-uppercase small mb-2">
                  <%= new Date(event.start_at).toLocaleDateString('en-NZ', { month: 'short', day: 'numeric', year: 'numeric', timeZone: 'Pacific/Auckland' }) %>
                </span>
                <h3 class="h6 mb-2">
                  <a href="/entertainment/<%= event.slug || event.id %><%= detailSuffix %>" class="stretched-link text-decoration-none">
                    <%= event.title %>
                  </a>
                </h3>
                <% const extraRooms = Array.isArray(event.additional_room_names) ? event.additional_room_names : []; %>
                <% const roomNames = [event.room_name].concat(extraRooms).filter(Boolean); %>
                <% if (roomNames.length) { %>
                  <p class="text-muted small mb-1"><i class="bi bi-geo-alt me-1"></i><%= roomNames.join(", ") %></p>
                <% } %>
                <% if (event.description) { %>
                  <p class="text-muted small mb-0"><%= event.description.replace(/<[^>]+>/g, '').slice(0, 80) %>...</p>
                <% } %>
              </div>
            </article>
          </div>
        <% }) %>
      </div>
    </div>
  </div>
<% } %>
