<% locals.layout = 'layouts/main'; %>


    <!-- ðŸ”¹ Body -->
    <div class="function-body py-4 px-4">
    
      <% if (grouped && Object.keys(grouped).length > 0) { %>
        <% Object.keys(grouped).forEach(date => { %>
          <div class="timeline-day mb-4">
            <h5 class="fw-normal text-secondary mb-3"><%= date %></h5>
            <div class="timeline-items d-flex flex-column gap-3">
              <% grouped[date].forEach(entry => { %>
                <div class="timeline-entry border rounded-3 p-3 shadow-sm"
                     style="background-color: #fafafa;">
                  <div class="entry-header d-flex justify-content-between align-items-center mb-1">
                    <strong class="fw-medium"><%= entry.subject || entry.note_type || entry.title || '(No subject)' %></strong>
                    <small class="text-muted">
                      <%= new Date(entry.entry_date || entry.created_at).toLocaleTimeString('en-NZ', { hour: '2-digit', minute: '2-digit' }) %>
                    </small>
                  </div>
                  <div class="entry-body text-secondary">
                    <%= entry.body || '(no content)' %>
                  </div>
                </div>
              <% }) %>
            </div>
          </div>
        <% }) %>
      <% } else { %>
        <p class="text-secondary">No recent communications, notes, or tasks yet.</p>
      <% } %>
    </div>
  </section>
</main>

<!-- ðŸ§± Shared Modals -->
<%- include('../../partials/functions/modals', {
  fn,
  linkedContacts: linkedContacts || [],
  rooms: rooms || [],
  eventTypes: eventTypes || []
}) %>

<!-- ðŸ§  JS Context -->
<script>
  window.fnContext = {
    id: "<%= fn.id_uuid %>",
    name: "<%= fn.event_name %>",
    status: "<%= fn.status %>",
    eventDate: "<%= fn.event_date ? fn.event_date.toISOString().split('T')[0] : '' %>"
  };
</script>

<script src="/js/functions/detail.js" defer></script>







