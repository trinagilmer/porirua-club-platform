<!-- üõ†Ô∏è pages/functions/edit.ejs -->
<% locals.layout = 'layouts/main'; %>


    <!-- üîπ Body -->
    <div class="function-body py-4 px-4">

      <!-- üßæ Edit Form -->
      <form method="POST" action="/functions/<%= fn.id_uuid %>/edit" class="card p-4 shadow-sm">
        <div class="row g-3">
          <div class="col-md-6">
            <label class="form-label">Event Name</label>
            <input type="text" name="event_name" class="form-control" value="<%= fn.event_name || '' %>" required />
          </div>

          <div class="col-md-3">
            <label class="form-label">Date</label>
            <input type="date" name="event_date" class="form-control"
                   value="<%= fn.event_date ? fn.event_date.toISOString().slice(0,10) : '' %>" />
          </div>

          <div class="col-md-6">
            <label class="form-label">Start Time</label>
            <input type="time" name="start_time" class="form-control" value="<%= fn.start_time || '' %>" />
          </div>

          <div class="col-md-6">
            <label class="form-label">End Time</label>
            <input type="time" name="end_time" class="form-control" value="<%= fn.end_time || '' %>" />
          </div>

          <div class="col-md-4">
            <label class="form-label">Attendees</label>
            <input type="number" name="attendees" class="form-control" value="<%= fn.attendees || '' %>" />
          </div>

          <div class="col-md-6">
            <label class="form-label">Budget ($)</label>
            <input type="number" step="0.01" name="budget" class="form-control" value="<%= fn.budget || '' %>" />
          </div>

          <div class="col-md-4">
            <label class="form-label">Total Price</label>
            <input type="number" step="0.01" name="totals_price" class="form-control" value="<%= fn.totals_price || 0 %>" />
          </div>

          <div class="col-md-4">
            <label class="form-label">Total Cost</label>
            <input type="number" step="0.01" name="totals_cost" class="form-control" value="<%= fn.totals_cost || 0 %>" />
          </div>

          <div class="col-md-6">
            <label class="form-label">Room / Space</label>
            <select name="room_id" class="form-select">
              <option value="">Select a room</option>
              <% rooms.forEach(r => { %>
                <option value="<%= r.id %>" <%= fn.room_id === r.id ? 'selected' : '' %>>
                  <%= r.name %> (<%= r.capacity %> ppl)
                </option>
              <% }) %>
            </select>
          </div>

          <div class="col-md-6">
            <label class="form-label">Event Type</label>
            <select name="event_type" class="form-select">
              <option value="">Select an event type</option>
              <% eventTypes.forEach(t => { %>
                <option value="<%= t.name %>" <%= fn.event_type === t.name ? 'selected' : '' %>><%= t.name %></option>
              <% }) %>
            </select>
          </div>

          <div class="col-md-6">
            <label class="form-label">Status</label>
            <select name="status" class="form-select">
              <% ['lead','qualified','confirmed','balance_due','completed'].forEach(st => { %>
                <option value="<%= st %>" <%= fn.status === st ? 'selected' : '' %>>
                  <%= st.replace('_', ' ') %>
                </option>
              <% }) %>
            </select>
          </div>

          <div class="col-md-6">
            <label class="form-label">Function Owner</label>
            <select name="owner_id" class="form-select">
              <option value="">Unassigned</option>
              <% (users || []).forEach(u => { %>
                <option value="<%= u.id %>" <%= fn.owner_id === u.id ? 'selected' : '' %>><%= u.name %></option>
              <% }) %>
            </select>
          </div>
        </div>

        <div class="mt-4 d-flex justify-content-end gap-2">
          <a href="/functions/<%= fn.id_uuid %>" class="btn btn-outline-secondary">Cancel</a>
          <button type="submit" class="btn btn-primary">Save Changes</button>
        </div>
      </form>
    </div>
  </section>
</main>

<!-- üß± Modals (shared across all function pages) -->
<%- include('../../partials/functions/modals', {
  fn,
  linkedContacts: linkedContacts || [],
  rooms: rooms || [],
  eventTypes: eventTypes || []
}) %>

<!-- ‚öôÔ∏è Scripts -->
<script>
  // ‚úÖ Use UUID-only context (no integer fallback)
  window.fnContext = {
    id: "<%= fn.id_uuid %>",
    name: "<%= fn.event_name %>",
    status: "<%= fn.status %>",
    eventDate: "<%= fn.event_date ? fn.event_date.toISOString().split('T')[0] : '' %>"
  };

  console.log("üõ†Ô∏è Function Context (Edit):", window.fnContext);
</script>

<!-- JS Controller -->
<script src="/js/functions/edit.js" defer></script>

