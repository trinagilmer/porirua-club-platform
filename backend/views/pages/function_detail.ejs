<!DOCTYPE html>
<html lang="en">
<head>
  <%- include('../partials/head') %>
  <title><%= fn.event_name %> - Edit Function</title>
</head>
<body>
  <%- include('../partials/header', { active: 'functions', user: user }) %>

  <main class="main-content">
    <h1 style="color:var(--deep);">Edit Function: <%= fn.event_name %></h1>

    <form method="POST" action="/function/<%= fn.id %>/update" class="card" style="margin-bottom:20px;">
      <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:16px;">
        <div>
          <label>Event Name</label>
          <input type="text" name="event_name" value="<%= fn.event_name %>" required>
        </div>
        <div>
          <label>Status</label>
          <select name="status">
            <% ['lead','qualified','confirmed','balance_due','completed','cancelled'].forEach(s=>{ %>
              <option value="<%= s %>" <%= fn.status===s?'selected':'' %>><%= s %></option>
            <% }) %>
          </select>
        </div>
        <div>
          <label>Date</label>
          <input type="date" name="event_date" value="<%= fn.event_date_str %>">
        </div>
        <div>
          <label>Time</label>
          <input type="text" name="event_time" value="<%= fn.event_time || '' %>" placeholder="18:00">
        </div>
        <div>
          <label>Attendees</label>
          <input type="number" name="attendees" value="<%= fn.attendees || '' %>">
        </div>
        <div>
          <label>Room</label>
          <input type="text" name="room_id" value="<%= fn.room_id || '' %>">
        </div>
        <div>
          <label>Total Price ($)</label>
          <input type="number" step="0.01" name="totals_price" value="<%= fn.totals_price || '' %>">
        </div>
      </div>
      <div style="margin-top:16px;">
        <label>Notes</label>
        <textarea name="notes" rows="4" style="width:100%;"><%= fn.notes || '' %></textarea>
      </div>
      <div style="margin-top:16px;text-align:right;">
        <button class="btn">Save Changes</button>
      </div>
    </form>

    <!-- Related Tabs -->
    <div class="card">
      <h2 style="color:var(--deep);margin-top:0;">Tasks</h2>
      <% if (!tasks.length) { %>
        <p>No tasks yet.</p>
      <% } else { %>
        <ul>
          <% tasks.forEach(t=>{ %>
            <li><strong><%= t.title %></strong> - <%= t.status %></li>
          <% }) %>
        </ul>
      <% } %>
    </div>

    <div class="card">
      <h2 style="color:var(--deep);">Proposal</h2>
      <p>Proposal Builder coming next â€” this section will let you build, view, and send client proposals with menus, items, and pricing.</p>
    </div>
  </main>
</body>
</html>
np