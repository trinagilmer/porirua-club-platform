<!DOCTYPE html>
<html lang="en">
<head>
  <%- include('../partials/head', { title: fn.event_name + ' - Function Details' }) %>
</head>
<body>
  <%- include('../partials/header', { active: 'functions', user: user }) %>

  <main class="main-content">
    <h1 style="color:var(--deep);margin-top:0;"><%= fn.event_name %></h1>

    <!-- Top Bar: Summary + Edit Button -->
    <div class="card" style="margin-bottom:20px;">
      <div style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;">
        <div>
          <p><strong>Status:</strong> <%= fn.status %></p>
          <p><strong>Date:</strong> <%= fn.event_date ? fn.event_date.toISOString().slice(0,10) : '—' %> 
             <%= fn.event_time ? '(' + fn.event_time + ')' : '' %></p>
          <p><strong>Attendees:</strong> <%= fn.attendees || '—' %></p>
          <p><strong>Room:</strong> <%= fn.room_id || '—' %></p>
          <p><strong>Value:</strong> $<%= (fn.totals_price || 0).toLocaleString() %></p>
        </div>
        <div style="text-align:right;">
          <a href="/functions/<%= fn.id %>/edit" class="btn">Edit Function</a>
          <a href="/functions" class="btn ghost">Back to Functions</a>
        </div>
      </div>
      <% if (fn.notes) { %>
        <div style="margin-top:16px;">
          <h3>Notes</h3>
          <p><%= fn.notes %></p>
        </div>
      <% } %>
    </div>

    <!-- Tasks Section -->
    <div class="card">
      <h2 style="color:var(--deep);margin-top:0;">Tasks</h2>
      <% if (!tasks || !tasks.length) { %>
        <p>No tasks yet.</p>
      <% } else { %>
        <table class="table">
          <thead>
            <tr>
              <th>Title</th>
              <th>Status</th>
              <th>Due</th>
            </tr>
          </thead>
          <tbody>
            <% tasks.forEach(t=>{ %>
              <tr>
                <td><%= t.title %></td>
                <td><%= t.status %></td>
                <td><%= t.due_at ? t.due_at.toISOString().slice(0,10) : '—' %></td>
              </tr>
            <% }) %>
          </tbody>
        </table>
      <% } %>
    </div>

    <!-- Proposal Placeholder -->
    <div class="card">
      <h2 style="color:var(--deep);">Proposal</h2>
      <p>Proposal Builder coming next — this section will let you build, view, and send client proposals with menus, items, and pricing.</p>
    </div>

    <!-- Documents -->
    <% if (documents && documents.length) { %>
      <div class="card">
        <h2 style="color:var(--deep);">Documents</h2>
        <ul>
          <% documents.forEach(d => { %>
            <li><a href="<%= d.file_url %>" target="_blank"><%= d.file_name %></a></li>
          <% }) %>
        </ul>
      </div>
    <% } %>
  </main>
</body>
</html>
