<!-- ðŸ“¬ Inbox Header -->
<div class="inbox-header-bar">
  <h1>ðŸ“¨ Inbox</h1>

  <% if (stats && stats.total) { %>
    <div class="inbox-stats">
      <div class="stat-box">
        <span class="stat-number"><%= stats.total %></span>
        <span class="stat-label">Total</span>
      </div>
      <div class="stat-box">
        <span class="stat-number linked"><%= stats.linked %></span>
        <span class="stat-label">Linked</span>
      </div>
      <div class="stat-box">
        <span class="stat-number unlinked"><%= stats.unlinked %></span>
        <span class="stat-label">Unlinked</span>
      </div>
    </div>
  <% } %>
</div>


<% if (!messages || !messages.length) { %>
  <div class="empty-box"><p>No messages found.</p></div>
<% } else { %>
  <div class="inbox-list">
    <% messages.forEach((m) => { 
         const sender = m.from_email || "Unknown Sender";
         const subject = m.subject || "(No Subject)";
         const preview = m.body_html ? m.body_html.replace(/<[^>]+>/g, '').slice(0, 120) 
          : (m.body ? m.body.slice(0, 120) : "(No content)");
         const dateVal = m.received_at || m.created_at;
         const linked = m.contact_name || m.function_name;
    %>
      <div 
        class="message-card"
        data-id="<%= m.id %>"
        data-linked="<%= linked ? 'true' : 'false' %>"
      >
        <div class="msg-left">
          <div class="msg-from">
            <%= sender %>
            <% if (linked) { %>
              <span class="badge badge-linked">Linked</span>
            <% } else { %>
              <span class="badge badge-unlinked">Unlinked</span>
            <% } %>
          </div>
          <div class="msg-subject"><%= subject %></div>
          <div class="msg-preview"><%= preview %></div>
        </div>
        <div class="msg-date" data-time="<%= dateVal %>"><%= dateVal ? new Date(dateVal).toLocaleString() : "" %></div>
      </div>
    <% }) %>
  </div>
<% } %>






