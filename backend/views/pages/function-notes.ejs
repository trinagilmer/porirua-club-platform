<!-- ğŸ§© Function Notes Page -->
<div class="function-page function-layout-two-col">

  <!-- ğŸ§­ SIDEBAR -->
  <%- include('../partials/sidebar', { fn, linkedContacts, rooms, eventTypes }) %>

  <!-- ğŸ§  MAIN CONTENT -->
  <section class="function-workspace">
    <!-- ===== Function Tabs ===== -->
    <%- include('../partials/function-tabs', { fn, activeTab: 'notes' }) %>

    <div class="workspace-content container mt-4">
      <h1 class="mb-3">Notes for <%= fn.event_name %></h1>

      <!-- ===== Add Note Form ===== -->
      <form id="quickNoteForm" class="mb-4">
        <div class="d-flex flex-column flex-md-row align-items-start gap-2">
          <select id="noteType" name="note_type" class="note-type-select">
            <option value="general">ğŸ“ General</option>
            <option value="followup">ğŸ“… Follow-up</option>
            <option value="internal">ğŸ”’ Internal</option>
            <option value="client">ğŸ’¬ Client</option>
          </select>
          <textarea id="quickNoteInput" name="content" class="form-control flex-grow-1"
            placeholder="Add a quick note..."></textarea>
          <button type="submit" class="btn btn-primary small">Add Note</button>
        </div>
      </form>

      <!-- ===== Notes List ===== -->
      <div id="notesList">
        <% if (notes && notes.length > 0) { %>
          <% notes.forEach(n => { %>
            <div class="note-card" data-id="<%= n.entry_id %>">
              <div class="note-meta">
                <span class="badge me-2 note-type-badge note-type-<%= n.note_type || 'general' %>">
                  <%= (n.note_type ? n.note_type.charAt(0).toUpperCase() + n.note_type.slice(1) : 'General') %>
                </span>
                <strong><%= n.author || 'Unknown' %></strong> â€¢
                <%= new Date(n.entry_date).toLocaleString('en-NZ', { year: 'numeric', month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' }) %>
                <% if (n.updated_at) { %> â€¢ <em>edited</em><% } %>
              </div>

              <div class="note-body" contenteditable="false">
                <%= n.body || '<em>No content</em>' %>
              </div>

              <div class="note-actions">
                <button class="btn small edit-note btn-outline-secondary">Edit</button>
                <button class="btn small save-note btn-success d-none">Save</button>
                <button class="btn small delete-note btn-outline-danger">Delete</button>
                <button class="btn small print-note btn-outline-secondary">ğŸ–¨ï¸ Print</button>
              </div>
            </div>
          <% }) %>
        <% } else { %>
          <p class="text-muted">No notes yet.</p>
        <% } %>
      </div>
    </div>
  </section>
</div>

<!-- ğŸ”¹ Include Modals & Overlay -->
<%- include('../partials/function-modals') %>

<!-- ğŸ”¹ JS Context -->
<script>
  window.fnContext = { id: "<%= fn.id %>" };
</script>

<!-- ğŸ”¹ Scripts -->
<script src="/js/sidebar.js"></script>
<script src="/js/function-notes.js"></script>



