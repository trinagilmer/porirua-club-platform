<!DOCTYPE html>
<html lang="en">
<head>
  <%- include('../partials/head', { title: fn.event_name + ' â€“ Function Detail' }) %>
</head>

<body>
  <!-- ðŸ”¹ Global Header -->
  <%- include('../partials/header', { active: 'functions', user }) %>

  <!-- ðŸ”¹ Two Column Layout -->
  <main class="function-layout-two-col" style="padding-top: 6rem;">
    
    <!-- ðŸ§­ Sidebar Partial -->
    <%- include('../partials/sidebar', { fn, linkedContacts, rooms, eventTypes }) %>

    <!-- ðŸ§© Workspace (Right Column) -->
    <section class="function-workspace">
      
      <!-- ðŸ§­ Function Tabs -->
      <%- include('../partials/function-tabs', { fn, activeTab }) %>

      <!-- ðŸ§¾ Main Workspace Content -->
      <div class="workspace-content">
        <% if (grouped && Object.keys(grouped).length > 0) { %>
          <% Object.keys(grouped).forEach(date => { %>
            <div class="timeline-day">
              <h5><%= date %></h5>
              <div class="timeline-items">
                <% grouped[date].forEach(entry => { %>
                  <div class="timeline-entry <%= entry.entry_type %>">
                    <div class="entry-header">
                      <strong><%= entry.subject || entry.note_type || entry.title || '(No subject)' %></strong>
                      <span class="entry-time">
                        <%= new Date(entry.entry_date).toLocaleTimeString('en-NZ', { hour: '2-digit', minute: '2-digit' }) %>
                      </span>
                    </div>
                    <div class="entry-body"><%= entry.body || '(no content)' %></div>
                  </div>
                <% }) %>
              </div>
            </div>
          <% }) %>
        <% } else { %>
          <p class="text-muted">No recent communications.</p>
        <% } %>
      </div>
    </section>
  </main>

  <!-- ðŸ”¹ Include contact modals -->
  <%- include('../partials/function-modals') %>

  <!-- ðŸ”¹ JS Context -->
  <script>
    window.fnContext = { id: "<%= fn.id %>" };
  </script>

  <!-- JS Scripts -->
  
  <script src="/js/sidebar.js"></script>
</body>
</html>

















