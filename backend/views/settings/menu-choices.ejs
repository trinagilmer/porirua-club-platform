<main class="container-fluid">
  <div class="row g-4">
    <div class="col-lg-8">
      <div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center gap-2 mb-3">
        <div>
          <h1 class="fw-bold text-primary mb-1">Menu Choices</h1>
          <div class="text-muted small">Maintain reusable choices grouped by sales category.</div>
        </div>
        <div class="d-flex flex-wrap align-items-center gap-2">
          <select id="choiceCategoryFilter" class="form-select form-select-sm" style="min-width: 200px;">
            <option value="all">All categories</option>
            <option value="unassigned">Unassigned</option>
            <% (categories || []).forEach(cat => { %>
              <option value="<%= cat.id %>"><%= cat.name %></option>
            <% }) %>
          </select>
          <a href="/settings/menus/bulk" class="btn btn-outline-secondary btn-sm">
            <i class="bi bi-upload me-1"></i> Bulk Upload
          </a>
        </div>
      </div>
      <div id="choicesContainer" class="vstack gap-4"></div>
    </div>

    <aside class="col-lg-4 d-flex flex-column gap-4">
      <div class="card shadow-sm">
        <div class="card-header bg-primary text-white">
          <h5 class="mb-0">Create Choice</h5>
        </div>
        <div class="card-body">
          <form id="createChoiceForm" class="vstack gap-3">
            <div>
              <label class="form-label small text-uppercase text-muted">Choice Name</label>
              <input type="text" name="choice_name" id="createChoiceName" class="form-control" placeholder="e.g. Main Course" required>
            </div>
            <div>
              <label class="form-label small text-uppercase text-muted">Default Option Label</label>
              <input type="text" name="option_name" id="createChoiceOptionName" class="form-control" placeholder="Defaults to choice name">
              <div class="form-text">This will be the first option shown in quotes.</div>
            </div>
            <div class="row g-2">
              <div class="col-md-4">
                <label class="form-label small text-uppercase text-muted">Price</label>
                <input type="number" step="0.01" name="option_price" id="createChoiceOptionPrice" class="form-control" placeholder="e.g. 24.50">
              </div>
              <div class="col-md-4">
                <label class="form-label small text-uppercase text-muted">Cost</label>
                <input type="number" step="0.01" name="option_cost" id="createChoiceOptionCost" class="form-control" placeholder="e.g. 12.00">
              </div>
              <div class="col-md-4">
                <label class="form-label small text-uppercase text-muted">Qty Type</label>
                <select name="option_unit" id="createChoiceOptionUnit" class="form-select">
                  <option value="">No unit</option>
                  <% (units || []).forEach(u => { %>
                    <option value="<%= u.id %>"><%= u.name %> (<%= u.type %>)</option>
                  <% }) %>
                </select>
              </div>
            </div>
            <div>
              <label class="form-label small text-uppercase text-muted">Description</label>
              <textarea name="choice_description" id="createChoiceDescription" rows="3" class="form-control" placeholder="Optional notes for staff..."></textarea>
            </div>
            <button type="submit" class="btn btn-success w-100">Create Choice</button>
          </form>
        </div>
      </div>
      <div class="card shadow-sm">
        <div class="card-body small text-muted">
          <p class="fw-semibold mb-1">Tips</p>
          <ul class="ps-3 mb-0">
            <li>Choices can be linked to many menus within the same sales category.</li>
            <li>Each choice can have multiple options with their own pricing and units.</li>
            <li>Need to add lots at once? Use the bulk upload tool.</li>
          </ul>
        </div>
      </div>
    </aside>
  </div>
</main>

<!-- Templates -->
<script>
  window.menuChoiceData = {
    choices: <%- JSON.stringify(choices || []) %>,
    categories: <%- JSON.stringify(categories || []) %>,
    units: <%- JSON.stringify(units || []) %>
  };
</script>
