<main class="settings-feedback py-4">
  <div class="d-flex justify-content-between align-items-center flex-wrap mb-4">
    <div>
      <h1 class="mb-1">Feedback &amp; Surveys</h1>
      <p class="text-muted mb-0">Control automatic survey emails after functions and restaurant bookings.</p>
    </div>
    <a href="/settings/overview" class="btn btn-link text-decoration-none">
      &larr; Back to overview
    </a>
  </div>

  <% if (flashMessage) { %>
    <div class="alert alert-<%= flashType === 'error' ? 'danger' : flashType || 'success' %>">
      <%= flashMessage %>
    </div>
  <% } %>

  <section class="card shadow-sm mb-4">
    <form class="card-body" method="POST" action="/settings/feedback">
      <div class="row g-4">
        <div class="col-md-6">
          <div class="form-check form-switch">
            <input class="form-check-input" type="checkbox" id="autoFunctions" name="auto_functions" <%= feedbackSettings.auto_functions ? 'checked' : '' %>>
            <label class="form-check-label" for="autoFunctions">
              Automatically email survey after functions
            </label>
          </div>
          <small class="text-muted">Uses the primary function contact if available.</small>
        </div>
        <div class="col-md-6">
          <div class="form-check form-switch">
            <input class="form-check-input" type="checkbox" id="autoRestaurant" name="auto_restaurant" <%= feedbackSettings.auto_restaurant ? 'checked' : '' %>>
            <label class="form-check-label" for="autoRestaurant">
              Automatically email survey after restaurant bookings
            </label>
          </div>
          <small class="text-muted">Uses the booking contact email if supplied.</small>
        </div>
        <div class="col-md-6">
          <label class="form-label">Send survey after (days)</label>
          <input type="number" class="form-control" name="send_delay_days" min="0" max="30" value="<%= feedbackSettings.send_delay_days %>">
          <small class="text-muted">Number of days after the booking date to send the first survey.</small>
        </div>
        <div class="col-md-6">
          <label class="form-label">Reminder after (days)</label>
          <input type="number" class="form-control" name="reminder_days" min="0" max="30" value="<%= feedbackSettings.reminder_days %>">
          <small class="text-muted">Optional reminder delay. Use 0 to disable reminders.</small>
        </div>
      </div>
      <div class="d-flex justify-content-end mt-4">
        <button type="submit" class="btn btn-primary">Save settings</button>
      </div>
    </form>
  </section>

  <section class="card shadow-sm">
    <div class="card-body">
      <h5 class="mb-3">Contact preferences</h5>
      <p class="text-muted mb-1">
        <strong><%= contactStats.optOutCount %></strong> contacts have opted out of surveys.
      </p>
      <p class="small text-muted mb-0">
        Contacts can be opted out individually from the Contacts page. Automatic emails will respect global settings, per-contact opt-outs, and the per-booking/ function toggles.
      </p>
    </div>
  </section>
</main>
