<!-- ===== Function Title Bar ===== -->
<%
  const formatTime = (value) => {
    if (!value) return null;
    const str = String(value);
    return str.length >= 5 ? str.slice(0, 5) : str;
  };
  const startTime = formatTime(fn?.start_time);
  const endTime = formatTime(fn?.end_time);
  const roomList = Array.isArray(rooms) ? rooms : [];
  const activeRoom =
    roomList.find((room) => String(room.id) === String(fn?.room_id)) || null;
%>
<div class="function-title-bar bg-light border-bottom py-3 mb-3">
  <div class="container d-flex justify-content-between align-items-center flex-wrap gap-3">
    <div>
      <h1 class="h4 fw-bold text-success mb-0">
        <% if (fn?.event_name) { %>
          <%= fn.event_name %>
          <% if (pageName) { %> - <%= pageName %><% } %>
        <% } else { %>
          <%= title || 'Function Details' %>
        <% } %>
      </h1>
      <div class="small text-muted">
        <% if (fn?.event_date) { %>
          <span><%= new Date(fn.event_date).toLocaleDateString() %></span>
        <% } %>
        <% if (startTime || endTime) { %>
          <span class="ms-3">
            <i class="bi bi-clock me-1"></i>
            <%= startTime || '--:--' %>
            &ndash;
            <%= endTime || '--:--' %>
          </span>
        <% } %>
        <% if (activeRoom) { %>
          <span class="ms-3">
            <i class="bi bi-geo-alt me-1"></i>
            <%= activeRoom.name %>
          </span>
        <% } %>
      </div>
    </div>

    <div class="text-muted small">
      <%= fn?.venue_name ? fn.venue_name : '' %>
    </div>
  </div>
</div>
