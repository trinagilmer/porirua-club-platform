<!-- ========================================================= -->
<!-- ðŸ§± FUNCTION MODALS & SLIDE PANELS (FINAL, SYNCED WITH JS) -->
<!-- Included once via layouts/function-shell.ejs               -->
<!-- ========================================================= -->

<!-- ðŸ”¹ Edit Contact Slide Panel -->
<div id="editContactPanel" class="contact-panel contact-edit-panel hidden">
  <div class="contact-edit-header">
    <h3>Edit Contact</h3>
    <button id="closeEditPanel" class="close" title="Close">&times;</button>
  </div>

  <form id="editContactForm" class="panel-form">
    <input type="hidden" id="editContactId" />
    <input type="hidden" id="editContactFnId" value="<%= fn.id_uuid %>" />

    <label for="editContactName">Name</label>
    <input type="text" id="editContactName" required />

    <label for="editContactEmail">Email</label>
    <input type="email" id="editContactEmail" required />

    <label for="editContactPhone">Phone</label>
    <input type="text" id="editContactPhone" />

    <label for="editContactCompany">Company</label>
    <input type="text" id="editContactCompany" />

    <div class="panel-actions">
      <button type="submit" class="btn btn-primary">ðŸ’¾ Save Changes</button>
      <button type="button" id="cancelEdit" class="btn ghost">Cancel</button>
    </div>
  </form>
</div>

<!-- ðŸ”¹ Add / Link Contact Slide Panel -->
<div id="addContactPanel" class="contact-panel contact-add-panel hidden" data-fn-id="<%= fn.id_uuid %>">
  <div class="contact-edit-header">
    <h3>Add Contact</h3>
    <button id="closeAddPanel" class="close" title="Close">&times;</button>
  </div>

  <div class="contact-panel-tabs">
    <button id="tabNew" class="tab-btn active">New Contact</button>
    <button id="tabExisting" class="tab-btn">Link Existing</button>
  </div>

  <!-- ðŸ†• New Contact Form -->
  <form id="newContactForm" class="panel-form" data-fn-id="<%= fn.id_uuid %>">
    <input type="hidden" id="newContactFnId" value="<%= fn.id_uuid %>" />

    <label for="newName">Name</label>
    <input type="text" id="newName" required />

    <label for="newEmail">Email</label>
    <input type="email" id="newEmail" required />

    <label for="newPhone">Phone</label>
    <input type="text" id="newPhone" />

    <label for="newCompany">Company</label>
    <input type="text" id="newCompany" />

    <div class="panel-actions">
      <button type="submit" class="btn btn-primary">ðŸ’¾ Save Contact</button>
    </div>
  </form>

  <!-- ðŸ§© Existing Contact Section -->
  <div id="existingContactSection" class="hidden" data-fn-id="<%= fn.id_uuid %>">
    <input type="text" id="searchContact" placeholder="Search contacts..." class="contact-search" />
    <select id="existingSelect" size="8" class="contact-dropdown"></select>
    <div class="panel-actions">
      <button id="linkExisting" class="btn btn-primary" data-fn-id="<%= fn.id_uuid %>">ðŸ”— Link Selected</button>
    </div>
  </div>
</div>

<!-- ðŸ”¹ Time Input Modal -->
<div id="timeModalContainer" class="time-modal-container hidden" role="dialog" aria-modal="true">
  <div class="time-modal-box">
    <div class="time-modal-header">
      <h5 id="timeModalTitle">Set Time</h5>
      <button type="button" id="closeTimeModal" class="time-modal-close">Ã—</button>
    </div>

    <div class="time-modal-body">
      <input type="time" id="timeInputField" class="time-modal-input" required />
    </div>

    <div class="time-modal-footer">
      <button id="saveTimeBtn" class="btn btn-primary">Save</button>
      <button id="cancelTimeBtn" class="btn ghost">Cancel</button>
    </div>
  </div>
</div>

<!-- ðŸ‘ï¸ View Contact Modal -->
<div id="viewContactModal" class="contact-modal hidden" role="dialog" aria-modal="true">
  <div class="contact-modal-content">
    <button id="closeViewModal" class="close" title="Close">&times;</button>
    <div id="contactModalBody" class="contact-modal-body">
      <p>Loading...</p>
    </div>
  </div>
</div>
<!-- ðŸ§¾ Add Payment Modal -->
<div class="modal fade" id="addPaymentModal" tabindex="-1" aria-labelledby="addPaymentModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="addPaymentModalLabel">Add Payment</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <form id="addPaymentForm">
        <div class="modal-body">
          <input type="hidden" id="paymentProposalId" value="<%= fn.id_uuid %>">
          <div class="mb-3">
            <label class="form-label">Payment Type</label>
            <select class="form-select" id="paymentType" required>
              <option value="">Select</option>
              <option value="Deposit">Deposit</option>
              <option value="Full amount">Full amount</option>
              <option value="Outstanding amount">Outstanding amount</option>
              <option value="Bar tab">Bar tab</option>
              <option value="Other">Other</option>
            </select>
          </div>
          <div class="mb-3">
            <label class="form-label">Amount ($)</label>
            <input type="number" step="0.01" class="form-control" id="paymentAmount" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Method</label>
            <select class="form-select" id="paymentMethod" required>
              <option value="">Select</option>
              <option value="Cash">Cash</option>
              <option value="EFTPOS">EFTPOS</option>
              <option value="Bank Transfer">Bank Transfer</option>
              <option value="Credit Card">Credit Card</option>
            </select>
          </div>
          <div class="mb-3">
            <label class="form-label">Status</label>
            <select class="form-select" id="paymentStatus" required>
              <option value="completed">Completed</option>
              <option value="pending">Pending</option>
            </select>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-primary">Save Payment</button>
        </div>
      </form>
    </div>
  </div>
</div>
<!-- ðŸ“œ Create Proposal Modal -->
<div class="modal fade" id="createProposalModal" tabindex="-1" aria-labelledby="createProposalModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="createProposalModalLabel">Create Proposal</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <form id="createProposalForm">
        <div class="modal-body">
          <input type="hidden" id="proposalFunctionId" value="<%= fn.id_uuid %>">
          <div class="mb-3">
            <label class="form-label">Status</label>
            <select class="form-select" id="proposalStatus">
              <option value="draft">Draft</option>
              <option value="sent">Sent</option>
              <option value="approved">Approved</option>
            </select>
          </div>
          <p class="text-muted small mb-0">A new proposal will be linked to this function.</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-success">Create Proposal</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- ðŸ”¹ Overlay for Slide Panels -->
<div id="contactOverlay" class="contact-overlay hidden" aria-hidden="true"></div>

