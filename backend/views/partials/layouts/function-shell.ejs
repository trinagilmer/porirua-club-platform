<main class="function-layout-two-col">
  <!-- ðŸ§­ Sidebar -->
  <%- include('../functions/sidebar', { fn, linkedContacts, rooms, eventTypes, roomAllocations }) %>

  <!-- ðŸ§© Main Workspace -->
  <section class="function-workspace">
    <!-- ðŸ”¹ Fixed Title Bar -->
    <%- include('../functions/title', { 
      fn, 
      title, 
      rooms,
      pageName: typeof activeTab !== 'undefined' && activeTab ? activeTab : 'overview' 
    }) %>

    <!-- ðŸ”¹ Tabs (fixed under title) -->
    <div class="function-tabs-wrapper">
      <%- include('../functions/tabs', { 
        fn, 
        activeTab: typeof activeTab !== 'undefined' && activeTab ? activeTab : 'overview' 
      }) %>
    </div>

    <!-- ðŸ”¹ Scrollable Body -->
    <div class="function-body">
      <% const viewToInclude = `../../pages/functions/${activeTab || 'overview'}`; %>
      <%- include(viewToInclude, { 
        fn, 
        grouped: typeof grouped !== 'undefined' ? grouped : null, 
        activeTab, 
        rooms, 
        eventTypes, 
        linkedContacts,
        roomAllocations
      }) %>
    </div>
  </section>
</main>

<!-- ðŸ§± GLOBAL FUNCTION MODALS & PANELS -->
<%- include('../functions/modals') %>

<!-- ðŸ§  JS Context -->
<script>
  document.body.dataset.page = "function-detail";
  window.fnContext = {
    id: "<%= fn.id_uuid %>",
    name: "<%= fn.event_name %>",
    userId: "<%= user ? user.id : '' %>"
  };
</script>

<!-- âš™ï¸ Initialise Core Scripts -->
<script type="module" src="/js/core/init.js"></script>
<script src="/js/functions/detail.js" defer></script>




